(()=>{if(window.__pomdLoaded)return;window.__pomdLoaded=!0;const e=e=>document.getElementById(e);function t(t){const n={time:e("pomd-time"),bar:e("pomd-bar"),toggle:e("pomd-toggle"),reset:e("pomd-reset"),skip:e("pomd-skip"),status:e("pomd-status"),full:e("pomd-full"),bgBtn:e("pomd-bg-btn"),card:t.querySelector(".pomd-card"),bgImg:t.querySelector(".pomd-bg")},o=(()=>{try{const e=t.dataset.bglist?JSON.parse(t.dataset.bglist):[];return Array.isArray(e)?e:[]}catch{return[]}})(),a=t.dataset.bg||"";a&&!o.includes(a)&&o.unshift(a);let i=Math.max(0,o.indexOf(a));function r(e){if(!o.length)return;i=(e+o.length)%o.length;const t=o[i];if(!n.bgImg){const e=document.createElement("img");e.className="pomd-bg",e.alt="Focus background",e.loading="eager",n.card.prepend(e),n.bgImg=e}n.bgImg.style.opacity="0",requestAnimationFrame(()=>{n.bgImg.src=t,n.bgImg.onload=()=>n.bgImg.style.opacity="1"})}function m(){o.length&&r(i+1)}function l(){o.length&&r(i-1)}function v(){if(!o.length)return;let e=Math.floor(Math.random()*o.length);o.length>1&&e===i&&(e=(e+1)%o.length),r(e)}o.length&&r(i);const g=25*60*1e3;let s={running:!1,start:0,end:0,total:g,t:null};const y=e=>{const t=Math.max(0,Math.round(e/1e3)),n=Math.floor(t/60),s=t%60;return String(n).padStart(2,"0")+":"+String(s).padStart(2,"0")};function d(){const t=Date.now(),e=Math.max(0,s.end-t);n.time&&(n.time.textContent=y(e)),n.bar&&(n.bar.style.width=100*(1-e/s.total)+"%"),n.status&&(n.status.textContent=s.running?"In progress":"Paused"),n.toggle&&(n.toggle.textContent=s.running?"Pause":"Start",n.toggle.setAttribute("aria-pressed",String(s.running)))}function b(){if(s.running)return;s.running=!0,(!s.start||Date.now()>=s.end)&&(s.start=Date.now(),s.end=s.start+s.total),O()}function u(){if(!s.running)return;s.running=!1,clearInterval(s.t),d()}function h(){clearInterval(s.t),s.running=!1,s.total=g,s.start=Date.now(),s.end=s.start+s.total,n.status&&(n.status.textContent="Ready"),d()}function c(){u(),n.status&&(n.status.textContent="Done!");try{const s=window.AudioContext||window.webkitAudioContext,e=new s,t=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.value=880,n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.25,e.currentTime+.02),n.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.6),t.connect(n).connect(e.destination),t.start(),t.stop(e.currentTime+.65)}catch{}}function O(){clearInterval(s.t),s.t=setInterval(()=>{Date.now()>=s.end&&(c(),clearInterval(s.t)),d()},250)}const j=()=>document.fullscreenElement===n.card||document.webkitFullscreenElement===n.card,w=()=>n.card.requestFullscreen?n.card.requestFullscreen():n.card.webkitRequestFullscreen&&n.card.webkitRequestFullscreen(),_=()=>document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),p=()=>j()?_():w(),f=()=>{const t=e("pomd-full");t&&(t.textContent=j()?"⤡":"⤢")};n.toggle?.addEventListener("click",()=>s.running?u():b()),n.reset?.addEventListener("click",h),n.skip?.addEventListener("click",c),n.bgBtn?.addEventListener("click",e=>{if(!o.length)return;e.ctrlKey||e.metaKey?v():e.shiftKey?l():m()}),e("pomd-full")?.addEventListener("click",p),document.addEventListener("fullscreenchange",f),document.addEventListener("webkitfullscreenchange",f),window.addEventListener("keydown",e=>{e.code==="Space"&&(e.preventDefault(),s.running?u():b()),(e.key==="r"||e.key==="R")&&h(),(e.key==="s"||e.key==="S")&&c(),(e.key==="f"||e.key==="F")&&p(),(e.key==="b"||e.key==="B")&&(e.ctrlKey||e.metaKey?v():e.shiftKey?l():m()),e.key==="ArrowRight"&&m(),e.key==="ArrowLeft"&&l()}),h(),f()}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-pomd]").forEach(t)})})()