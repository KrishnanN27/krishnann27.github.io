(()=>{if(window.__pomdLoaded)return;window.__pomdLoaded=!0;const e=e=>document.getElementById(e);function t(t){const s={time:e("pomd-time"),bar:e("pomd-bar"),toggle:e("pomd-toggle"),reset:e("pomd-reset"),skip:e("pomd-skip"),status:e("pomd-status"),phase:e("pomd-phase"),full:e("pomd-full"),bgBtn:e("pomd-bg-btn"),card:t.querySelector(".pomd-card"),bgImg:t.querySelector(".pomd-bg")},o=(()=>{try{const e=t.dataset.bglist?JSON.parse(t.dataset.bglist):[];return Array.isArray(e)?e:[]}catch{return[]}})(),a=t.dataset.bg||"";a&&!o.includes(a)&&o.unshift(a);let i=Math.max(0,o.indexOf(a));function r(e){if(!o.length)return;i=(e+o.length)%o.length;const t=o[i];if(!s.bgImg){const e=document.createElement("img");e.className="pomd-bg",e.alt="Focus background",e.loading="eager",s.card.prepend(e),s.bgImg=e}s.bgImg.style.opacity="0",requestAnimationFrame(()=>{s.bgImg.src=t,s.bgImg.onload=()=>s.bgImg.style.opacity="1"})}function l(){o.length&&r(i+1)}function u(){o.length&&r(i-1)}function _(){if(!o.length)return;let e=Math.floor(Math.random()*o.length);o.length>1&&e===i&&(e=(e+1)%o.length),r(e)}o.length&&r(i);const b=25*60*1e3;let n={running:!1,start:0,end:0,total:b,t:null};const y=e=>{const t=Math.max(0,Math.round(e/1e3)),n=Math.floor(t/60),s=t%60;return String(n).padStart(2,"0")+":"+String(s).padStart(2,"0")};function m(){const t=Date.now(),e=Math.max(0,n.end-t);s.time.textContent=y(e),s.bar.style.width=100*(1-e/n.total)+"%",s.status.textContent=n.running?"In progress":"Paused",s.toggle.textContent=n.running?"Pause":"Start",s.toggle.setAttribute("aria-pressed",String(n.running))}function p(){if(n.running)return;n.running=!0,(!n.start||Date.now()>=n.end)&&(n.start=Date.now(),n.end=n.start+n.total),w()}function f(){if(!n.running)return;n.running=!1,clearInterval(n.t),m()}function h(){clearInterval(n.t),n.running=!1,n.total=b,n.start=Date.now(),n.end=n.start+n.total,s.phase.textContent="Focus",s.status.textContent="Ready",m()}function c(){f(),s.status.textContent="Done!",s.phase.textContent="Break";try{const s=window.AudioContext||window.webkitAudioContext,e=new s,t=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.value=880,n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.25,e.currentTime+.02),n.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.6),t.connect(n).connect(e.destination),t.start(),t.stop(e.currentTime+.65)}catch{}}function w(){clearInterval(n.t),n.t=setInterval(()=>{Date.now()>=n.end&&(c(),clearInterval(n.t)),m()},250)}const g=()=>document.fullscreenElement===s.card||document.webkitFullscreenElement===s.card,O=()=>s.card.requestFullscreen?s.card.requestFullscreen():s.card.webkitRequestFullscreen&&s.card.webkitRequestFullscreen(),x=()=>document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),v=()=>g()?x():O(),d=()=>{const t=e("pomd-full");t&&(t.textContent=g()?"Exit full screen":"Full screen")};s.toggle.addEventListener("click",()=>n.running?f():p()),s.reset.addEventListener("click",h),s.skip.addEventListener("click",c),s.bgBtn&&s.bgBtn.addEventListener("click",e=>{if(!o.length)return;e.shiftKey?u():l()});const j=e("pomd-full");j&&j.addEventListener("click",v),document.addEventListener("fullscreenchange",d),document.addEventListener("webkitfullscreenchange",d),window.addEventListener("keydown",e=>{e.code==="Space"&&(e.preventDefault(),n.running?f():p()),(e.key==="r"||e.key==="R")&&h(),(e.key==="s"||e.key==="S")&&c(),(e.key==="f"||e.key==="F")&&v(),(e.key==="b"||e.key==="B")&&(e.ctrlKey||e.metaKey?_():e.shiftKey?u():l()),e.key==="ArrowRight"&&l(),e.key==="ArrowLeft"&&u()}),h(),d()}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-pomd]").forEach(t)})})()