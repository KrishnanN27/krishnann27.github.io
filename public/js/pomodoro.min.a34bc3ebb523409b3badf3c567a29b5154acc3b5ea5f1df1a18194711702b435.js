(()=>{if(window.__pomdLoaded)return;window.__pomdLoaded=!0;const e=e=>document.getElementById(e);function t(t){const s={time:e("pomd-time"),bar:e("pomd-bar"),toggle:e("pomd-toggle"),reset:e("pomd-reset"),status:e("pomd-status"),full:e("pomd-full"),bgBtn:e("pomd-bg-btn"),card:t.querySelector(".pomd-card"),bgImg:t.querySelector(".pomd-bg")},o=(()=>{try{const e=t.dataset.bglist?JSON.parse(t.dataset.bglist):[];return Array.isArray(e)?e:[]}catch{return[]}})(),a=t.dataset.bg||"";a&&!o.includes(a)&&o.unshift(a);let i=Math.max(0,o.indexOf(a));function r(e){if(!o.length)return;i=(e+o.length)%o.length;const t=o[i];if(!s.bgImg){const e=document.createElement("img");e.className="pomd-bg",e.alt="Focus background",e.loading="eager",s.card.prepend(e),s.bgImg=e}s.bgImg.style.opacity="0",requestAnimationFrame(()=>{s.bgImg.src=t,s.bgImg.onload=()=>s.bgImg.style.opacity="1"})}function l(){o.length&&r(i+1)}function d(){o.length&&r(i-1)}function v(){if(!o.length)return;let e=Math.floor(Math.random()*o.length);o.length>1&&e===i&&(e=(e+1)%o.length),r(e)}o.length&&r(i);const f=25*60*1e3;let n={running:!1,start:0,end:0,total:f,t:null};const j=e=>{const t=Math.max(0,Math.round(e/1e3)),n=Math.floor(t/60),s=t%60;return String(n).padStart(2,"0")+":"+String(s).padStart(2,"0")};function m(){const t=Date.now(),e=Math.max(0,n.end-t);s.time&&(s.time.textContent=j(e)),s.bar&&(s.bar.style.width=100*(1-e/n.total)+"%"),s.toggle&&(s.toggle.textContent=n.running?"⏸":"▶",s.toggle.setAttribute("aria-pressed",String(n.running)),s.toggle.setAttribute("aria-label",n.running?"Pause":"Start"))}function p(){if(n.running)return;n.running=!0,(!n.start||Date.now()>=n.end)&&(n.start=Date.now(),n.end=n.start+n.total),O()}function c(){if(!n.running)return;n.running=!1,clearInterval(n.t),m()}function h(){clearInterval(n.t),n.running=!1,n.total=f,n.start=Date.now(),n.end=n.start+n.total,m()}function x(){c();try{const s=window.AudioContext||window.webkitAudioContext,e=new s,t=e.createOscillator(),n=e.createGain();t.type="sine",t.frequency.value=880,n.gain.setValueAtTime(1e-4,e.currentTime),n.gain.exponentialRampToValueAtTime(.25,e.currentTime+.02),n.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.6),t.connect(n).connect(e.destination),t.start(),t.stop(e.currentTime+.65)}catch{}}function O(){clearInterval(n.t),n.t=setInterval(()=>{Date.now()>=n.end&&(x(),clearInterval(n.t)),m()},250)}const y=()=>!!(s.card.requestFullscreen||s.card.webkitRequestFullscreen||document.fullscreenEnabled||document.webkitFullscreenEnabled),g=()=>document.fullscreenElement===s.card||document.webkitFullscreenElement===s.card,_=()=>{if(s.card.requestFullscreen)return s.card.requestFullscreen();if(s.card.webkitRequestFullscreen)return s.card.webkitRequestFullscreen();alert("Fullscreen is not supported on this device/browser.")},w=()=>{if(document.exitFullscreen)return document.exitFullscreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()},b=()=>{if(!y()){alert("Fullscreen mode isn’t available on this device/browser.");return}g()?w():_()},u=()=>{const t=e("pomd-full");t&&(t.textContent=g()?"⤡":"⤢")};s.toggle?.addEventListener("click",()=>n.running?c():p()),s.reset?.addEventListener("click",h),s.bgBtn?.addEventListener("click",e=>{if(!o.length)return;e.ctrlKey||e.metaKey?v():e.shiftKey?d():l()}),e("pomd-full")?.addEventListener("click",b),document.addEventListener("fullscreenchange",u),document.addEventListener("webkitfullscreenchange",u),window.addEventListener("keydown",e=>{e.code==="Space"&&(e.preventDefault(),n.running?c():p()),(e.key==="r"||e.key==="R")&&h(),(e.key==="f"||e.key==="F")&&b(),(e.key==="b"||e.key==="B")&&(e.ctrlKey||e.metaKey?v():e.shiftKey?d():l()),e.key==="ArrowRight"&&l(),e.key==="ArrowLeft"&&d()}),h(),u()}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-pomd]").forEach(t)})})()